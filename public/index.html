<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Seagold AR Business Card</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="./assets/mindar/mindar-image-aframe.prod.js"></script>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    /* ==================== FONT & TEXT STYLING ==================== */
    a-text {
      font-family: 'Poppins', sans-serif !important;
      font-weight: 700 !important;
      text-shadow: 
        1px 1px 2px rgba(0,0,0,0.3),
        -1px -1px 1px rgba(255,255,255,0.2) !important;
    }
    
    /* Header Text */
    .header-text {
      font-size: 0.12rem !important;
      letter-spacing: 0.01rem !important;
    }
    
    /* Body Text */
    .body-text {
      font-size: 0.07rem !important;
    }
    
    /* Contact Info */
    .contact-text {
      font-size: 0.06rem !important;
    }
    
    /* Call-to-Action */
    .cta-text {
      font-size: 0.08rem !important;
    }

    /* ==================== MAP ANIMATION FIXES ==================== */
    .map-container {
      position: absolute;
      right: -0.7rem; /* Start hidden */
      top: -0.2rem;
      width: 0.6rem;
      height: 0.4rem;
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
      z-index: 10;
    }
    
    .map-container.visible {
      right: 0.35rem; /* Slide in position */
      opacity: 1;
      pointer-events: auto;
    }

    #mapPlane {
      width: 0.55rem;
      height: 0.35rem;
      background-color: #ddd;
    }

    .map-toggle {
      position: absolute;
      right: 0.45rem;
      bottom: -0.35rem;
      width: 0.08rem;
      height: 0.08rem;
      background: #4a954e;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 15;
    }

    .map-toggle:hover {
      transform: scale(1.2);
      background: #3a853e;
    }
  </style>
</head>
<body>
  <!-- ==================== AR SCENE CONTAINER ==================== -->
  <a-scene mindar-image="imageTargetSrc: ./assets/targets.mind; 
                        autoStart: true; 
                        uiScanning: true; 
                        wasmPath: ./assets/mindar/;
                        filterMinCF: 0.01;
                        filterBeta: 0.001;"
           embedded 
           color-space="sRGB" 
           renderer="colorManagement: true, physicallyCorrectLights"
           device-orientation-permission-ui="enabled: true">

    <a-camera position="0 0 0"></a-camera>

    <!-- ==================== TARGET ANCHOR POINT ==================== -->
    <a-entity id="anchor" mindar-image-target="targetIndex: 0">
      <!-- ==================== BUSINESS CARD ==================== -->
      <a-plane position="0 0 0" width="1" height="0.9" color="#f2ede3"
               animation="property: position; to: 0 0.05 0; dur: 800; easing: easeOutElastic"
               shadow="receive: true">

        <!-- ==================== CARD CONTENT ==================== -->
        <a-text class="header-text" value="Seagold Dormitory"
                position="0 0.35 0.02" 
                align="center" 
                width="1.2" 
                color="#4a954e" 
                scale="1 1 1"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-text>

        <a-text class="body-text" value="Comfort Away From Home"
                position="0 0.28 0.02"
                align="center"
                width="1"
                color="#d2a647"></a-text>

        <a-text class="contact-text" value="📞 09225927385"
                position="-0.42 0.16 0.02"
                width="1"
                color="#333"></a-text>

        <a-text class="contact-text" value="📧 seagold.service@gmail.com"
                position="-0.42 0.08 0.02"
                width="1"
                color="#333"></a-text>

        <a-text class="contact-text" value="📍 3/F Fern Bldg, Sampaloc, Manila"
                position="-0.42 0.00 0.02"
                width="1"
                color="#333"></a-text>

        <a-text class="contact-text url-link" value="🌐 Seagold Dormitory (Facebook)"
                position="-0.42 -0.08 0.02"
                width="1"
                color="#0066cc"
                onclick="window.open('https://facebook.com/seagolddormitory', '_blank')"></a-text>

        <!-- ==================== MAP TOGGLE BUTTON ==================== -->
        <a-entity class="map-toggle clickable" 
                 onclick="toggleMap()"></a-entity>

        <!-- ==================== SLIDING MAP CONTAINER ==================== -->
        <a-entity class="map-container">
          <a-plane id="mapPlane" material="shader: flat"></a-plane>
        </a-entity>

        <!-- ==================== CALL TO ACTION ==================== -->
        <a-text class="cta-text clickable" value="Visit Our Website"
                position="0 -0.42 0.02"
                align="center"
                width="0.8"
                color="#00bf63"
                animation="property: scale; to: 1.1 1.1 1; dir: alternate; dur: 1000; loop: true"
                onclick="window.open('https://seagold-dormitory.vercel.app', '_blank')"></a-text>
      </a-plane>
    </a-entity>
  </a-scene>

  <!-- ==================== DEBUG CONSOLE ==================== -->
  <div id="debug-console"></div>

  <script>
    // ==================== DEBUG SYSTEM ====================
    const debugConsole = document.getElementById('debug-console');
    function debugLog(message) {
      const entry = document.createElement('div');
      entry.textContent = `[DEBUG] ${new Date().toLocaleTimeString()}: ${message}`;
      debugConsole.appendChild(entry);
      debugConsole.scrollTop = debugConsole.scrollHeight;
      console.log(message);
    }

    // ==================== MAP TOGGLE FUNCTION ====================
    function toggleMap() {
      const mapContainer = document.querySelector('.map-container');
      mapContainer.classList.toggle('visible');
      
      if (mapContainer.classList.contains('visible')) {
        debugLog("Map sliding out");
        loadMapTexture();
      } else {
        debugLog("Map sliding back");
      }
    }

    // ==================== MAP SYSTEM ====================
    const GOOGLE_API_KEY = "AIzaSyBoAmNMyi-pULIdPSAjDMbRsrHMWeXLLrE";
    const dormPos = { lat: 14.603919, lng: 120.987760 };

    function loadMapTexture() {
      const mapPlane = document.getElementById("mapPlane");
      if (!mapPlane) return;

      // Only load if not already loaded
      if (mapPlane.hasAttribute('material') && mapPlane.getAttribute('material').src) {
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userPos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          const zoom = 15;
          const size = "400x300";
          const marker = `color:red%7C${dormPos.lat},${dormPos.lng}`;
          const mapUrl = `https://maps.googleapis.com/maps/api/staticmap?center=${dormPos.lat},${dormPos.lng}&zoom=${zoom}&size=${size}&markers=${marker}&key=${GOOGLE_API_KEY}`;
          
          const img = new Image();
          img.onload = function() {
            mapPlane.setAttribute("material", "shader: flat; src: " + mapUrl);
            debugLog("🗺️ Map loaded successfully");
          };
          img.onerror = function() {
            debugLog("⚠️ Failed to load map image");
            mapPlane.setAttribute("color", "#4a954e");
          };
          img.src = mapUrl;
        },
        (error) => {
          debugLog("Geolocation error, using default map");
          const defaultUrl = `https://maps.googleapis.com/maps/api/staticmap?center=${dormPos.lat},${dormPos.lng}&zoom=15&size=400x300&markers=color:red%7C${dormPos.lat},${dormPos.lng}`;
          mapPlane.setAttribute("material", "shader: flat; src: " + defaultUrl);
        }
      );
    }

    // ==================== INITIALIZATION ====================
    window.addEventListener('load', () => {
      debugLog("System ready");
      // Initialize any required components
    });
  </script>
</body>
</html>